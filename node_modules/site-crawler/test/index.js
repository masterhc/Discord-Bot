var Crawler = require('../')
var ProgressBar = require('progress')

var site = 'https://techcrunch.com'

var crawler = new Crawler({
	concurrency:5
})
var bar = new ProgressBar('[:bar] :percent :current/:total :etas ', {
	stream:process.stdout,
	complete: '=',
	incomplete: ' ',
	width: 20,
	total: crawler.queued
})
crawler
.on('found',function(url,next) {
	var ok = url.startsWith(site)
	if(ok) console.error('found:',url)
	next(ok ? url : null)
})
.on('crawl',function(url,res,$,next) {
	console.error('\tcrawl:',$('title').text())
	bar.total = crawler.queued
	bar.tick()
	next()
})
.on('error',function(url,err) {
	console.error('\terror:',url,':',err.statusCode)
	bar.tick()
})
.on('complete',function() {
	console.log('done.')
})
crawler.start(site)

